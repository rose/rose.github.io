<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Superluser (python)</title><link>http://rose.github.io/</link><description></description><atom:link rel="self" href="http://rose.github.io/categories/python.xml" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Sun, 18 May 2014 19:26:14 GMT</lastBuildDate><generator>Nikola &lt;http://getnikola.com/&gt;</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Baby's First Decorator - Caching Functions</title><link>http://rose.github.io/posts/babys-first-decorator-caching-functions/</link><description>&lt;div&gt;&lt;p&gt;If and when I work up the nerve to interview, I know exactly how to answer one question:  My greatest weakness is perfectionism.&lt;/p&gt;
&lt;p&gt;This isn't some bullshit "Ah'm so awesome, even mah weaknesses are strengths" answer.  Perfectionism sucks.  There's a line between paying attention to details and being utterly paralyzed by preemptive self-criticism.  My aspiration is to get closer to that line, so I can throw rocks at those attentive assholes.&lt;/p&gt;
&lt;p&gt;Hah!  Just kidding, bro.  One thing an aspiring programmer is supposed to do is write a blog that appeals to the kind of person who makes hiring decisions based on blogs &lt;a class="footnote-reference" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id6" id="id1"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You know the blogs I mean.  The ones full of bouncy little posts about writing a C++ compiler in SQL while completing an iron man triathlon, with just enough self-deprecating humour to show that the author hasn't let his obvious awesomeness go to his head.  Rather enjoy them myself.&lt;/p&gt;
&lt;p&gt;In fact, I've been looking forward to writing a blog like that for some time, but the impressive projects still don't seem to have materialized.  What to do?&lt;/p&gt;
&lt;p&gt;Well, step number A is to get over my codestipation.  I've been doing that by forcing out a little pellet of code every morning, regardless of whether I feel the urge.  It's oddly satisfying to just lower my standards and &lt;em&gt;make&lt;/em&gt; something, no matter how hard &lt;a class="footnote-reference" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id7" id="id2"&gt;[2]&lt;/a&gt; it is.&lt;/p&gt;
&lt;p&gt;So, here's my first attempt at cheerily boasting about my latest emission.  Ugh.  I mean, enjoy!&lt;/p&gt;
&lt;div class="section" id="zomg-you-guys-decorators-are-so-cool"&gt;
&lt;h2&gt;ZOMG You Guys Decorators are So Cool&lt;/h2&gt;
&lt;small&gt;An awesome blog post by Rose Ames!  Follow me on Twitter or I'll eat your face!&lt;/small&gt;&lt;br&gt;Â &lt;p&gt;Today I was telling my husband about decorators!  They take a thing and run it through a bunch of publicly unacknowledged manoeuvers, leaving the thing outwardly the same even though inwardly it will never ever be the same again.  So they're basically like sex, except that I'm going to show you how we did them last night.  Ready?  Cool beans!&lt;/p&gt;
&lt;p&gt;Here's a fibonacci function in python (I know, pretty vanilla.  We'll get to the good stuff in a minute).&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Import that sucker into your repl and give it a whirl.  If you've never encountered exponential runtime before it's pretty eye-opening.  On my computer, fib(25) is instant, fib(30) has a barely noticeable pause, fib(35) takes a couple seconds, and fib(40) maxed out one of my processors for about 20 seconds before I got bored and ^c'ed it.&lt;/p&gt;
&lt;p&gt;Even if your computer's twice as fast as mine, I bet you don't sit through fib(50).&lt;/p&gt;
&lt;p&gt;Now, it's not too much trouble to alter this function, either to make it iterative or to store and look up previously calculated values.  But this is an example of a more general problem - what if this was a big hairy function we didn't want to mess around with?  Or if we had 100 small functions with the same problem?&lt;/p&gt;
&lt;p&gt;Well, we're programmers.  Let's automate that shit.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;cache&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cached_func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;arg&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cached_func&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;That'll show 'em!  Thanks to the Magic of Closures, we can create a function that stores the output of func(n) the first time we calculate it, and then just returns the stored value the next time that result is requested.  Let's try it out in the Super Evaluating-Loop Box &lt;a class="footnote-reference" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id8" id="id3"&gt;[3]&lt;/a&gt;!&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cached_fib&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fib&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cached_fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# takes a couple seconds!  HOW CAN THIS BE???&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cached_fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;35&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# second call is instant.  Hmmm...&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Do you see what's going on here?  We're calling cached_fib(35), and it is caching its result just as we commanded lo these many seconds ago.  However.  All those nasty exponentially-breeding subcalls are to the original, uncached version of fib - so the initial calculation is still mucho crapslow.&lt;/p&gt;
&lt;p&gt;But we can fix that, because we're &lt;em&gt;just that nifty&lt;/em&gt;, aren't we? &lt;a class="footnote-reference" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id9" id="id4"&gt;[4]&lt;/a&gt;&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;fib&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cached_fib&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;fib&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# instant&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Isn't that beautiful?  If you're not somewhat sexually aroused right now get the hell off my blog.&lt;/p&gt;
&lt;p&gt;It turns out this pattern...&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do_fancy_shit_to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="c"&gt;# create some_other_func by doing fancy shit to func&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;some_other_func&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pirate_say&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="c"&gt;# do regular shit&lt;/span&gt;

&lt;span class="n"&gt;pirate_say&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;do_fancy_shit_to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pirate_say&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;... is actually pretty common.  Common enough that Guido van-passing-an-object-explicitly-to-its-methods-was-good-enough-for-my-gramma-and-dammit-it's-good-enough-for-you-Rossum saw fit to include syntactic sugar for it; the above is exactly equivalent to&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do_fancy_shit_to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="c"&gt;# create some_other_func by doing fancy shit to func&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;some_other_func&lt;/span&gt;

&lt;span class="nd"&gt;@do_fancy_shit_to&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pirate_say&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="c"&gt;# do regular shit&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Thanks Guido!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="epilogue"&gt;
&lt;h2&gt;Epilogue&lt;/h2&gt;
&lt;p&gt;Well, I achieved half of the goals &lt;a class="footnote-reference" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id10" id="id5"&gt;[5]&lt;/a&gt; I set for this post.  It's not perfect, but it's what I've got, and that'll have to do.  At least until I finish my interactive graphic novel/dissertation about the version-controlled distributed database I'm planning to write in brainfuck.&lt;/p&gt;
&lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;br&gt;Â &lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Not to stereotype, but they're all upper middle class 21-year-old boys who live on pizza and red bull and play a lot of ping-pong.  God help me.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;and smelly&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;That's what REPL actually stands for.  I think it's Finnish or something.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id9" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;I ASKED YOU A QUESTION SCUM!!!&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id10" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"&gt;&lt;col&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="http://rose.github.io/posts/babys-first-decorator-caching-functions/#id5"&gt;[5]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;short and crappy.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>python</category><category>perfectionism</category><guid>http://rose.github.io/posts/babys-first-decorator-caching-functions/</guid><pubDate>Sun, 18 May 2014 12:17:11 GMT</pubDate></item></channel></rss>