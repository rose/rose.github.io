<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Prime Time | Superluser</title>

    
            <link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

    
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">

      <link rel="canonical" href="http://rose.github.io/posts/prime-time/">




    
        <!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->

    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans%7CDroid+Sans+Mono">


    

    <meta name="author" content="Rose Ames">
        <link rel="prev" href="../../posts/real-time/" title="Real Time" type="text/html">
    
    <meta property="og:site_name" content="Superluser">
    <meta property="og:title" content="Prime Time">
    <meta property="og:url" content="http://rose.github.io/posts/prime-time/">
    <meta property="og:description" content="I just finished pairing with Gargravarr. [1]  My sinister metacarpals have been in revolt for the last couple of days, [2] so he drove and I mumbled incoherently &lt;esc&gt;d2bi navigated.  We're learning R">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2014-11-17T02:43:54+00:00">

    

    



</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://rose.github.io/">

                <span id="blog-title">Superluser</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li>
<a href="../../archive.html">Archives</a>
                </li>
<li>
<a href="../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS</a>

                
            </li>
</ul>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
    <li>
    <a href="../../posts/prime-time/index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container" id="content">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <header>
        
    <h1 class="p-name entry-title" itemprop="headline name"><a href="../../posts/prime-time/" class="u-url">Prime Time</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Rose Ames</span></p>
            <p class="dateline"><a href="../../posts/prime-time/" rel="bookmark"><time class="published dt-published" datetime="2014-11-17T02:43:54+00:00" itemprop="datePublished" title="2014-11-17 02:43">2014-11-17 02:43</time></a></p>
                <p class="commentline">
        
    <a href="../../posts/prime-time/#disqus_thread" data-disqus-identifier="cache/posts/prime-time.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="../../posts/prime-time/index.rst" id="sourcelink">Source</a></p>

        </div>
        

    </header>

    <div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I just finished pairing with Gargravarr. <a class="footnote-reference" href="../../posts/prime-time/#id3" id="id1">[1]</a>  My sinister metacarpals have been in revolt for the last couple of days, <a class="footnote-reference" href="../../posts/prime-time/#id4" id="id2">[2]</a> so he drove and I mumbled incoherently &lt;esc&gt;d2bi navigated.  We're learning Rust and finding it a little rough.</p>
<!-- TEASER_END -->
<p>The language itself seems quite nice - MLesque syntax along with some really interesting ideas about how to ensure memory safety without incurring the costs of garbage collection - but it has changed so often in the past year that our combined google-fu availed us naught (or at least not much).</p>
<p>The documentation is in the middle of a major overhaul; what's up so far looks good but seems to be aimed at people without much C or C++ experience.  We often found ourselves asking, "ok, but what's the compiler <em>doing</em>?"  This sort of information is not (yet) easily available.</p>
<p>In any case, it was a fun session.  We don't have anything postable just yet, but today's a code day, so I wrote the Sieve of Whatsisname with Python generators:</p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">numbers</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">i</span>
</pre>
<p>The generator defined here is about as simple as they get - it lazily generates an infinite sequence of integers one at a time.  Numbers is not a generator itself; it's a function that returns a generator.  You can play with it like this:</p>
<pre class="code python literal-block">
<span class="n">number_gen</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">()</span>
<span class="k">print</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">number_gen</span><span class="p">))</span> <span class="c"># 2</span>
<span class="k">print</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">number_gen</span><span class="p">))</span> <span class="c"># 3</span>
<span class="k">print</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">number_gen</span><span class="p">))</span> <span class="c"># 4, and so on</span>
<span class="n">other_gen</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">()</span>
<span class="k">print</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">other_gen</span><span class="p">))</span> <span class="c"># 2, we made a whole new generator</span>
<span class="k">print</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">number_gen</span><span class="p">))</span> <span class="c"># 5, picks up from where we left it</span>
</pre>
<p>Starting at 2 is not a bug, it's a feature.  When you're working with prime numbers 1 is a nuisance.</p>
<p>The next function's slightly more complicated:</p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">make_filter</span><span class="p">(</span><span class="n">prime</span><span class="p">,</span> <span class="n">prev_filter</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">prev_filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">candidate</span> <span class="o">%</span> <span class="n">prime</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">candidate</span>
</pre>
<p>This one takes arguments.  Fancy!</p>
<p>The generators it creates will act as filters, to ensure our prime generator never sees a composite number.  For example, after we have made 7, we want to make sure that no other multiples of 7 are ever generated.  So we'll call make_filter with 7 and our previous chain of filters.  This will create a new generator which just pulls results out of the old chain, and passes them through - provided they are not divisible by 7.</p>
<p>Using numbers and make_filter, we can finally define a prime generator:</p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">primes</span><span class="p">():</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">next_prime</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_filter</span><span class="p">(</span><span class="n">next_prime</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">next_prime</span>
</pre>
<p>Our pipeline starts as a generator that would like nothing better than to spew an endless stream of mixed prime and composite numbers into your lap.  But, every result it gives us lets us create the next filter we need and stick it on the end of the hose.</p>
<p>Try it out:</p>
<pre class="code python literal-block">
<span class="n">prime_generator</span> <span class="o">=</span> <span class="n">primes</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">prime_generator</span><span class="p">))</span>
</pre>
<p>This will give you the first hundred prime numbers, up to 541.  This is not the most practical implementation - the chain of next's in our pipeline will max out your recursion depth pretty quickly - but it's kind of a fun way to play with generators.</p>
<p>I'm sure Whatsisname would be proud.</p>
<br> <br> <br> <br> <br> <br> <br> <br> <br> <table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top">
<tr>
<td class="label"><a class="fn-backref" href="../../posts/prime-time/#id1">[1]</a></td>
<td>The highly quotogenic Dan Luu.  You might remember him from such other posts as <a class="reference external" href="../../posts/the-poor-workman/">The Poor Workman</a> and <a class="reference external" href="../../posts/the-write-stuff/">The Write Stuff</a>.</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top">
<tr>
<td class="label"><a class="fn-backref" href="../../posts/prime-time/#id2">[2]</a></td>
<td>I'm typing this one-handed, and not for the usual reason.</td>
</tr>
</tbody>
</table>
</div>
    </div>
    <aside class="postpromonav">
    <nav>
    

    
        <ul class="pager">
            <li class="previous">
                <a href="../../posts/real-time/" rel="prev" title="Real Time">Previous post</a>
            </li>
        </ul>

    </nav>
    </aside>
        <section class="comments">
        <h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="superluser",
            disqus_url="http://rose.github.io/posts/prime-time/",
        disqus_title="Prime Time",
        disqus_identifier="cache/posts/prime-time.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
    

</article>

        
       <script>var disqus_shortname="superluser";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>



        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:rose@happyspork.com">Rose Ames</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
    </div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script>jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    <!-- fancy dates -->
    <script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script>
    <!-- end fancy dates -->
    


</body>
</html>
